language: groovy
jdk:
  - openjdk8
os:
  - linux
before_cache: 
  - echo "################################################## START CACHE"
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
after_cache:
  - echo "################################################## FINISH CACHE"
script:
  - gradle clean build
  - export RELEASE_PKG_FILE=$(ls build/distributions/*.zip)
  - echo "# Zip File => $RELEASE_PKG_FILE"

before_deploy:
  - export RELEASE_PKG_FILE=$(ls build/distributions/*.zip)
  - echo "################################################## START DEPLOY "
  - echo "# Deploying $RELEASE_PKG_FILE to GitHsub releases"

deploy:
  provider: releases
  api_key:
    secure: CLvKTpH/B42NDft0om2OGyMWNY/BeeUNvEKhd+UxIxHV86qGxNbHC2rGiqpJwr8QfTSjxLNoy/GwygRWjhpzRUdjxJz8LXjOD8DWPYncmRnfvTRddDtVkJgDRkwN4pnu4nIRSUEFakDvraVRBOMWZ+k2ObQbIsbAfdMA0NzQZfy3pbSCf818j8yeC/XX42zeFmBkazP9kxcFMB8BOGRpoUuRmGkAS6xhB3Uj7k1jzJkFNkftx6iuccNL2HBj3tx20VTtMPk1+uZZAG+WRokqeYTx3XXQcIO8OhWggvJtqQCxT5ImHWqGfCXmzKrHK2SGwJfGZ7gq9KjgxDjvoTW5GXVDMWSveQic8cJ0zRta9qwTi4JygQWB7QdOJslHNFUW+5o4QLyTGhEJJgLZzQZnss0TZZlVjQEZfhog1lfUGN7K3MmwH92UKoc0CEN+IEN87mQyYetTCv1RdzTnFgNEsDuBJ5INBWN276GOlTdul4lgc/wlH+IRVcbetmilowT8T5E+TafVtH2LVHjyH39N+0cYth+/n8Oy1LEOwWKvrT11ty7SJkyHfi6DbgQumU2pIwsu1pa2q6VaHKBozRsmV1EqaaEOB7TYzYoYrQEwbt5Kogcp4Vyr0s4bf4sT5+1yesRq9LgwxVLAK7PaHpJoGnqXOpDwTLhlehHRqSDTbQc=
  file: "build/distributions/*.zip"
  file_glob: true
  skip_cleanup: true
  on:
    tags: true
    repo: avaj-java/installer-maker
    all_branches: true

after_deploy:
  - echo "################################################## FINISH DEPLOY"
  
